{% extends "base.html" %}
{% block title %}Home â€” PKI-Advanced{% endblock %}
{% block content %}

<div class="page-header" style="text-align:center; padding:2rem 0 2.5rem">
    <div class="page-label">// enterprise certificate authority</div>
    <h1 class="page-title" style="font-size:2.4rem">PKI-Advanced</h1>
    <p class="page-sub" style="font-size:1rem">
        Welcome, <strong style="color:var(--heading)">{{ current_user.username }}</strong> â€”
        <span class="role-pill role-{{ current_user.role_name }}">{{ current_user.role_name | upper }}</span>
    </p>
</div>
<!-- 3 Portal Cards -->
<div style="display:grid; grid-template-columns:repeat(3,1fr); gap:1.5rem; max-width:900px; margin:0 auto">

    <!-- User Portal â€” available to all -->
    <a href="/portal/user" style="text-decoration:none">
        <div class="card" style="text-align:center; padding:2.5rem 1.5rem; transition:all 0.25s; cursor:pointer"
             onmouseover="this.style.borderColor='var(--accent2)';this.style.transform='translateY(-4px)'"
             onmouseout="this.style.borderColor='var(--border)';this.style.transform='translateY(0)'">
            <div style="font-size:3rem; margin-bottom:1rem">ğŸ‘¤</div>
            <div style="font-size:1.1rem; font-weight:800; color:var(--heading); margin-bottom:0.5rem">User Portal</div>
            <div style="font-size:0.8rem; color:var(--muted); line-height:1.8">
                Request certificates<br>View your certs<br>Download &amp; manage
            </div>
            <div style="margin-top:1.25rem">
                <span class="badge badge-active">â— Open</span>
            </div>
        </div>
    </a>

    <!-- Server Portal â€” server_admin or ca_admin only -->
    {% set can_server = current_user.is_server_admin() or current_user.is_ca_admin() %}
    <a href="{{ '/portal/server' if can_server else '#' }}" style="text-decoration:none"
       {% if not can_server %}onclick="alert('Server Admin role required to access this portal.');return false"{% endif %}>
        <div class="card" style="text-align:center; padding:2.5rem 1.5rem; transition:all 0.25s;
                                  cursor:{{ 'pointer' if can_server else 'not-allowed' }};
                                  opacity:{{ '1' if can_server else '0.6' }}"
             {% if can_server %}
             onmouseover="this.style.borderColor='var(--warning)';this.style.transform='translateY(-4px)'"
             onmouseout="this.style.borderColor='var(--border)';this.style.transform='translateY(0)'"
             {% endif %}>
            <div style="font-size:3rem; margin-bottom:1rem">ğŸ–¥ï¸</div>
            <div style="font-size:1.1rem; font-weight:800; color:var(--heading); margin-bottom:0.5rem">Server Portal</div>
            <div style="font-size:0.8rem; color:var(--muted); line-height:1.8">
                Server certificates<br>Renewal management<br>SSL/TLS certs
            </div>
            <div style="margin-top:1.25rem">
                {% if can_server %}
                    <span class="badge badge-active">â— Open</span>
                {% else %}
                    <span class="badge badge-revoked">ğŸ”’ Restricted</span>
                {% endif %}
            </div>
        </div>
    </a>

    <!-- CA Portal â€” ca_admin only -->
    {% set can_ca = current_user.is_ca_admin() %}
    <a href="{{ '/portal/ca' if can_ca else '#' }}" style="text-decoration:none"
       {% if not can_ca %}onclick="alert('CA Admin role required to access this portal.');return false"{% endif %}>
        <div class="card" style="text-align:center; padding:2.5rem 1.5rem; transition:all 0.25s;
                                  cursor:{{ 'pointer' if can_ca else 'not-allowed' }};
                                  opacity:{{ '1' if can_ca else '0.6' }}"
             {% if can_ca %}
             onmouseover="this.style.borderColor='var(--accent)';this.style.transform='translateY(-4px)'"
             onmouseout="this.style.borderColor='var(--border)';this.style.transform='translateY(0)'"
             {% endif %}>
            <div style="font-size:3rem; margin-bottom:1rem">ğŸ›ï¸</div>
            <div style="font-size:1.1rem; font-weight:800; color:var(--heading); margin-bottom:0.5rem">CA Portal</div>
            <div style="font-size:0.8rem; color:var(--muted); line-height:1.8">
                Approve requests<br>Issue &amp; revoke certs<br>CRL Â· OCSP Â· Audit
            </div>
            <div style="margin-top:1.25rem">
                {% if can_ca %}
                    <span class="badge badge-active">â— Open</span>
                {% else %}
                    <span class="badge badge-revoked">ğŸ”’ Restricted</span>
                {% endif %}
            </div>
        </div>
    </a>

</div>
{% endblock %}