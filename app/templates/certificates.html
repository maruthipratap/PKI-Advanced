{% extends "base.html" %}
{% block title %}Certificates ‚Äî PKI-Advanced{% endblock %}
{% block content %}

<div class="page-header">
    <div class="page-label">// certificate registry</div>
    <h1 class="page-title">All Certificates</h1>
    <p class="page-sub">Filter by status ‚Äî click any certificate to view full details</p>
</div>

<!-- Filter Tabs -->
<div style="display:flex; gap:0.5rem; margin-bottom:1.5rem; flex-wrap:wrap">
    {% for label, key, color in [
        ('All', 'all', 'var(--accent)'),
        ('Active', 'active', 'var(--accent2)'),
        ('Revoked', 'revoked', 'var(--danger)'),
        ('Expired', 'expired', 'var(--warning)')
    ] %}
    <a href="/certificates?filter={{ key }}"
       style="text-decoration:none; display:inline-flex; align-items:center; gap:0.5rem;
              padding:0.45rem 1rem; border-radius:8px; font-size:0.8rem; font-weight:700;
              border:1px solid {{ 'transparent' if active_filter == key else 'var(--border)' }};
              background:{{ 'rgba(0,0,0,0.3)' if active_filter == key else 'transparent' }};
              color:{{ color if active_filter == key else 'var(--muted)' }}">
        {{ label }}
        <span style="background:rgba(255,255,255,0.08); padding:0.1rem 0.45rem;
                     border-radius:4px; font-family:var(--mono); font-size:0.7rem">
            {{ counts[key] }}
        </span>
    </a>
    {% endfor %}
</div>

<!-- Table -->
<div class="card" style="padding:0">
    {% if certs %}
    <div class="table-wrap" style="border:none; border-radius:12px">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Owner</th>
                    <th>Email</th>
                    <th>Organization</th>
                    <th>Issued</th>
                    <th>Expires</th>
                    <th>Status</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for cert in certs %}
                <tr>
                    <td class="mono text-muted" style="font-size:0.72rem">{{ cert.id }}</td>
                    <td style="font-weight:700; color:var(--heading)">{{ cert.owner_name }}</td>
                    <td class="text-muted" style="font-size:0.78rem">{{ cert.email or '‚Äî' }}</td>
                    <td class="text-muted" style="font-size:0.78rem">{{ cert.organization or '‚Äî' }}</td>
                    <td class="mono" style="font-size:0.73rem">{{ cert.issued_at.strftime('%Y-%m-%d') }}</td>
                    <td class="mono" style="font-size:0.73rem
                        {% if cert.is_expired() %};color:var(--danger){% endif %}">
                        {{ cert.valid_to.strftime('%Y-%m-%d') }}
                    </td>
                    <td>
                        {% if cert.status == 'ACTIVE' and not cert.is_expired() %}
                            <span class="badge badge-active">‚óè ACTIVE</span>
                        {% elif cert.status == 'REVOKED' %}
                            <span class="badge badge-revoked">‚úï REVOKED</span>
                        {% else %}
                            <span class="badge badge-expired">‚è∞ EXPIRED</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="/view/{{ cert.id }}" class="text-accent"
                           style="font-size:0.78rem; text-decoration:none">View ‚Üí</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align:center; padding:4rem; color:var(--muted)">
        <div style="font-size:3rem; margin-bottom:1rem">üìã</div>
        <div>No certificates found for this filter.</div>
        <a href="/certificates" class="btn btn-ghost" style="margin-top:1rem; display:inline-flex">Clear Filter</a>
    </div>
    {% endif %}
</div>
{% endblock %}